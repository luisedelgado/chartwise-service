# fly.toml app configuration file for chartwise-service-prod

app = 'chartwise-service-prod'
primary_region = 'mia'

[build]

[http_service]
  internal_port = 8080
  force_https = true
  processes = ['app']
  min_machines_running = 1
  auto_stop_machines = "suspend"
  auto_start_machines = true
  [http_service.concurrency]
    type = "requests"
    soft_limit = 20
    hard_limit = 40

  # Region-specific overrides
  [http_service.regions.mia]
    auto_start_machines = true
    auto_stop_machines = false

  [http_service.regions.dfw]
    auto_start_machines = true
    auto_stop_machines = false

[[vm]]
memory = "2gb"
cpu_kind = "shared"
cpus = 2

[machines.app]
  count = 4

[processes]
  app = "uvicorn app.main:app --host 0.0.0.0 --port 8080"
